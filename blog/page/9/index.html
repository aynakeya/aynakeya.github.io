<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0-rc2">

  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
  <link rel="mask-icon" href="/static/favicon/safari_pinned_tab.svg" color="#222">
  <link rel="manifest" href="/static/favicon/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.aynakeya.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":null,"post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInDown","sidebar":"fadeInDown"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="my blog~">
<meta property="og:type" content="website">
<meta property="og:title" content="blog">
<meta property="og:url" content="http://www.aynakeya.com/blog/page/9/index.html">
<meta property="og:site_name" content="Aynakeya&#39;s Blog">
<meta property="og:description" content="my blog~">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Aynakeya">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.aynakeya.com/blog/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":false,"lang":"en","comments":"","permalink":"","path":"blog/page/9/index.html","title":"blog"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Aynakeya's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Aynakeya's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Kill My Emotion</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-house fa-fw"></i>Home</a></li><li class="menu-item menu-item-infosec"><a href="/categories/ctf" rel="section"><i class="fa fa-solid fa-code fa-fw"></i>InfoSec</a></li><li class="menu-item menu-item-coding"><a href="/categories/coding" rel="section"><i class="fa fa-solid fa-code fa-fw"></i>Coding</a></li><li class="menu-item menu-item-anime"><a href="/categories/anime" rel="section"><i class="fa fa-solid fa-film fa-fw"></i>Anime</a></li><li class="menu-item menu-item-novel"><a href="/categories/novel" rel="section"><i class="fa fa-solid fa-book-open fa-fw"></i>Novel</a></li><li class="menu-item menu-item-life"><a href="/categories/life" rel="section"><i class="fa fa-solid fa-book fa-fw"></i>Life</a></li><li class="menu-item menu-item-devops"><a href="/categories/devops" rel="section"><i class="fa fa-solid fa-terminal fa-fw"></i>DevOps</a></li><li class="menu-item menu-item-sceneseries"><a href="/scene-series" rel="section"><i class="fa fa-solid fa-book fa-fw"></i>SceneSeries</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-ctf-writeup"><a href="/ctf-writeup" rel="section"><i class="fa fa-book fa-fw"></i>CTF-writeup</a></li><li class="menu-item menu-item-bookmarks"><a href="/bookmarks" rel="section"><i class="fa fa-bookmark fa-fw"></i>Bookmarks</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-js-projects"><a href="/my-js-project" rel="section"><i class="fas fa-folder fa-fw"></i>Js-projects</a></li><li class="menu-item menu-item-frontpage"><a href="/" rel="section"><i class="fa fa-leaf fa-fw"></i>Frontpage</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Aynakeya"
      src="/static/intro/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Aynakeya</p>
  <div class="site-description" itemprop="description">my blog~</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives">
          <span class="site-state-item-count">114</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">88</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/aynakeya" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;aynakeya" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:aynakeya.official@gmail.com" title="E-Mail → mailto:aynakeya.official@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/10003632" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;10003632" rel="noopener me" target="_blank"><i class="fas fa-video fa-fw"></i>Bilibili</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-04-17-16-43-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-04-17-16-43-23/" class="post-title-link" itemprop="url">Problem about install windows 10 in mac os with bootcamp.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-04-17 16:43:23" itemprop="dateCreated datePublished" datetime="2019-04-17T16:43:23+08:00">2019-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4/" itemprop="url" rel="index"><span itemprop="name">系统默认</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>problem 1</strong>: stuck at &quot;partition disk&quot;.</p>
<p><strong>solution</strong>: </p>
<ol>
<li><p>force quit boot camp</p>
</li>
<li><p>then open disk utility.</p>
</li>
<li><p>click partition, delete all other partition (using the - symbol)that bootcamp made. including: <em>OSXRECOVER</em> and <em>BOOTCAMP</em>.</p>
</li>
<li><p>open bootcamp again and try re-install again.</p>
</li>
</ol>
<hr>
<p><strong>problem 2</strong>: An error occurred while copying the Windows installation files</p>
<p><strong>reason</strong>:  because bootcamp using a 8g FAT32 disk partition to copy windows file, since FAT32 can not support file larger than 4g. any windows file larger than 4g will cause this problem happen.</p>
<p><strong>solution</strong>: </p>
<ol>
<li>use a ISO that have file size smaller than 4g.</li>
<li>known iso that can not use: 1703 1803 1809 (may work on your computer)</li>
<li>known iso that can use: none</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-04-06-18-00-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-04-06-18-00-02/" class="post-title-link" itemprop="url">use table partition to increase inserting performance</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-04-06 18:00:02" itemprop="dateCreated datePublished" datetime="2019-04-06T18:00:02+08:00">2019-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4/" itemprop="url" rel="index"><span itemprop="name">系统默认</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>when the number of data excess 5 million. mysql database will face a significant drop down in inserting speed. </p>
<p>(From 50,000 data per second to 50,000 data per minutes xD)</p>
<p>So we can &quot;split&quot; these data into different part by using mysql partition.</p>
<p>for example:</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca876ea63fb1.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca876ea63fb1.jpg" alt="table"></a><br>total number of data<br><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca8775dafb2f.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca8775dafb2f.jpg" alt="total"></a></p>
<p>change table to partition (<strong>the table can not have foreign key</strong>)</p>
<pre>
alter table songrecogn.fingerprints partition by range columns(id)
( PARTITION p0 VALUES LESS THAN (5000000),
  PARTITION p1 VALUES LESS THAN (10000000) ,
  PARTITION p2 VALUES LESS THAN (15000000) ,
  PARTITION p3 VALUES LESS THAN (20000000) ,
  PARTITION p4 VALUES LESS THAN (25000000) ,
  PARTITION p5 VALUES LESS THAN (30000000) ,
  PARTITION p6 VALUES LESS THAN (35000000) ,
  PARTITION p7 VALUES LESS THAN (40000000) ,
  PARTITION p8 VALUES LESS THAN (45000000) ,
  PARTITION p9 VALUES LESS THAN (50000000) ,
  PARTITION p10 VALUES LESS THAN (55000000) ,
  PARTITION p11 VALUES LESS THAN (60000000) ,
  PARTITION p12 VALUES LESS THAN (65000000) ,
  PARTITION p13 VALUES LESS THAN (70000000) ,
  PARTITION p14 VALUES LESS THAN (75000000),
  PARTITION p15 VALUES LESS THAN (80000000),
  PARTITION p16 VALUES LESS THAN (85000000),
  PARTITION p17 VALUES LESS THAN (90000000),
  PARTITION p18 VALUES LESS THAN (95000000),
  PARTITION p19 VALUES LESS THAN (100000000)
);
</pre>

<p>result:<br><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca8779ca8061.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca8779ca8061.jpg" alt="files"></a></p>
<p>The inserting speed remains in 50,000 per seconds.</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca87888b3a7c.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca87888b3a7c.jpg" alt="reuslt1"></a> </p>
<p>extra info:</p>
<pre>
# add partition
ALTER TABLE fingerprints ADD PARTITION(
 PARTITION p2- VALUES LESS THAN (150000000)
);

# remove partition (data not lost)
alter table fingerprints remove partitioning

# remove partition (data lost)
alter table fingerprints drop partition p20
</pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-04-06-17-38-45/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-04-06-17-38-45/" class="post-title-link" itemprop="url">Fix memory error caused by memory overflowing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-04-06 17:38:45" itemprop="dateCreated datePublished" datetime="2019-04-06T17:38:45+08:00">2019-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4/" itemprop="url" rel="index"><span itemprop="name">系统默认</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>When I was adding all my song to the data base yesterday, I always found memory error after several song was processed.</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca87477be5a0.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca87477be5a0.jpg" alt="memory error"></a></p>
<p>after checking the task manager, i found i got memory overflow when processing the song.</p>
<p>After doing some research, i come up with a solution.</p>
<p>By using <code>del</code> and <code>gc.collect()</code> after finish using a varible that takes lots of memory, the problem is successfully solved.</p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca8737adf701.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca8737adf701.jpg" alt="code1"></a></p>
<p><a target="_blank" rel="noopener" href="https://i.loli.net/2019/04/06/5ca8737b03578.jpg"><img data-src="https://i.loli.net/2019/04/06/5ca8737b03578.jpg" alt="code2"></a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-04-06-17-28-58/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-04-06-17-28-58/" class="post-title-link" itemprop="url">Improving sqlalchemy inserting performance for large set of data</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-04-06 17:28:58" itemprop="dateCreated datePublished" datetime="2019-04-06T17:28:58+08:00">2019-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <pre>
# using add()
for d in data:
    fingerprint0 = tbModel(id=d)
    session.add(fingerprint0)
session.commit()

# using bulk_save_objects
dbs.bulk_save_objects([tbModel(id = d) for d in data])
dbs.commit()


# using bulk_insert_mappings
session.bulk_insert_mappings(tbModel,[{"id": d,} for d in data])
  

# using core
def run(self):
session.execute(tbModel.__table__.insert(),[{"id": d, } for d in data])
session.commit()

</pre>

<p>in these four way, the speed</p>
<p><strong>core &gt; bulk_insert_mappings &gt; bulk_save_objects &gt;&gt;&gt;&gt;&gt; add()</strong></p>
<p>add is slower than others for almost 10 times</p>
<p>Just not use add when inserting large amount of data.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-03-16-20-39-27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-03-16-20-39-27/" class="post-title-link" itemprop="url">Electron packaging</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-03-16 20:39:27" itemprop="dateCreated datePublished" datetime="2019-03-16T20:39:27+08:00">2019-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E9%BB%98%E8%AE%A4/" itemprop="url" rel="index"><span itemprop="name">系统默认</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Two method, electron-builder or electron-packager</p>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p> <code>npm isntall -g electron-packager</code> and  <code>npm isntall -g electron-builder</code></p>
<h2 id="Use-electron-packager"><a href="#Use-electron-packager" class="headerlink" title="Use electron packager:"></a>Use electron packager:</h2><p><code>electron-packager &lt;sourcedir&gt; &lt;appname&gt; &lt;platform&gt; &lt;architecture&gt; &lt;electron version&gt; &lt;optional options&gt;</code></p>
<p>e.g:</p>
<p><code>electron-packager . ApplicationName --win --out ./out --arch=x64 --overwrite --ignore=node_module</code></p>
<h2 id="Use-electron-builder"><a href="#Use-electron-builder" class="headerlink" title="Use electron builder"></a>Use electron builder</h2><p>add this script into your package.json</p>
<pre>
"build": {
    "appId": "com.xxx.app",
    "mac": {
      "target": ["dmg","zip"]
    },
    "win": {
      "target": ["nsis","zip"]
 }
</pre>
<p>Then, use <code>electron-builder</code>. You can also add args like <code>electron-builder --win --x64</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-02-11-22-53-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-02-11-22-53-22/" class="post-title-link" itemprop="url">Solution to mplayer playing voice and picture out of sync</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-02-11 22:53:22" itemprop="dateCreated datePublished" datetime="2019-02-11T22:53:22+08:00">2019-02-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>when i was playing with mplayer in my ras pi. I found that it always appear warning &quot;Your system is too slow to play this&quot;. And voice often play faster than the video.</p>
<p>after some modifying with config and option, i found nothing was helpful.</p>
<p>(Btw, you should tune the speed of lcd screen at least 48000000, but you may find some strange colour behaviour appear lol)</p>
<p>So, finally, i tried to re encode my video.</p>
<p>result turns out that we can simply solve this problem by encode the video into the older encoding format like <strong>mpg</strong> or <strong>ogg</strong>.</p>
<p><strong>don&#39;t</strong> use format like <strong>mp4</strong> or <strong>flv</strong></p>
<p>Result:</p>
<p><code>mplayer -nolirc -vo fbdev2:/dev/fb1 -fs -zoom -x 480 -y 320 ~/Videos/BadApple.mpg</code></p>
<p>ogg format:<br><img data-src="https://i.loli.net/2019/02/11/5c618bdf1bc7a.jpg" alt="ogg.JPG"></p>
<p>mpg format:<br><img data-src="https://i.loli.net/2019/02/11/5c618bdf2f6b5.jpg" alt="mpg.JPG"></p>
<p>flv format:<br><img data-src="https://i.loli.net/2019/02/11/5c618bdf26da4.jpg" alt="flv.JPG"></p>
<p>Look at the a-v,<br>You can see a significant difference between the mpg and flv.</p>
<p>Which means flv always face sync problem while mpg not.</p>
<p>Update:</p>
<p>add <code>-lavdopts skipframe=nonref:skiploopfilter=all</code> may helo</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-02-09-20-53-39/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-02-09-20-53-39/" class="post-title-link" itemprop="url">raspberry pi using vnc, can't log in.</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-02-09 20:53:39" itemprop="dateCreated datePublished" datetime="2019-02-09T20:53:39+08:00">2019-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Last night, when i was using vnc to log in my ras pi, i found that i stuck in the login menu.</p>
<p>which means even i type the correct password, after several sec, it going back to the login menu.</p>
<p>So, it turns out vnc may have some authoritive problem. WE can simply solve this problem by log in the ssh use：</p>
<p><code>rm -rf /home/pi/.Xauthority</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-02-09-20-46-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-02-09-20-46-15/" class="post-title-link" itemprop="url">Fininshing Update Shazam analysis(chinese version)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-02-09 20:46:15" itemprop="dateCreated datePublished" datetime="2019-02-09T20:46:15+08:00">2019-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>See </p>
<p><a target="_blank" rel="noopener" href="https://www.lxgshadow.us/blog/article-detail/13">First section</a><br>-<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv1904784">Bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.lxgshadow.us/blog/article-detail/14">Second section</a>-<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv1965924">Bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.lxgshadow.us/blog/article-detail/15">Third section</a>-<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv2016569">Bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-02-09-20-39-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-02-09-20-39-15/" class="post-title-link" itemprop="url">Shazam听歌识曲算法解析+python实现-3 检索歌曲</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-02-09 20:39:15" itemprop="dateCreated datePublished" datetime="2019-02-09T20:39:15+08:00">2019-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>第三部份<br>在开始之前，我们首先要认真阅读一下论文《An Industrial-Strength Audio Search Algorithm》。 </p>
<p>paper下载链接：<a target="_blank" rel="noopener" href="https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf">https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf</a><br>中文翻译：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yutianzuijin/article/details/49787551">https://blog.csdn.net/yutianzuijin/article/details/49787551</a><br>建议读英文的鸭。</p>
<p>为获得良好的阅读体验，你可能先需要了解 mysql数据库的基础知识，python基础语法，一定的代码阅读能力，一定的语文理解能力(up写的很乱)。</p>
<p>好的，那么今天我们进入最后一部分，搜索与匹配。</p>
<p>Up在这里使用了orm框架SQLalchemy</p>
<p>首先，我们要建立起一个数据库来储存上一步中获取的指纹信息。</p>
<p>其中一个表来储存歌曲信息，一个表来储存歌曲信息对应的指纹，两个表用歌曲的id作为外键相连。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec8390fcbc.jpg" alt="sqlalchemy的格式"></p>
<p>注意，fingerprint 这个column 必须要加上index，这将会大大减少查询速度，千真万确。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec838e9dd2.jpg" alt="songs表"><br>songs 表为歌曲信息表：</p>
<p>id 用来储存歌曲id，</p>
<p>name用来存储歌曲名字</p>
<p>filehash用来储存该歌曲文件的哈希</p>
<p>fingerprinted用来判断该歌曲是否已经进行了fingerprint</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec838bfdee.jpg" alt="fingerprints表"></p>
<p>Fingerprints 表为储存指纹的表：</p>
<p>id为指纹id，没什么用</p>
<p>song_id 是外键，记录对应的歌曲信息</p>
<p>fingerprint就是获取到的指纹信息</p>
<p>offset就是该指纹的offset位置</p>
<p>建完这个表，然后你就可以把指纹信息全都放进去了。</p>
<p>然后，我们来讲讲搜索与识别的基本原理：</p>
<p>1.首先输入一段声音，然后和之间一样，获取这一段声音的指纹。</p>
<p>2.对获取到的每一个指纹，在数据库中搜索相同的指纹，并将指纹对应的歌曲信息，以及offset偏移值保存。</p>
<p>3.有相同offset差值越多的歌曲就是识别出的歌曲。</p>
<p>tk’&#x3D;tk+offset,</p>
<p>这样子说可能有点抽象，我们来举个栗子:</p>
<p>假如在某个音频中，你提取到了1个指纹，这个指纹是 c19dde0ecb8fca81b6c98d5ee3775c26cbb32a610c82a5ecda515b0beb86d357， 且它在那段音频中的offset 是 30。</p>
<p>通过这个指纹，你在数据库中取到了如下的数据</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec838ebb90.jpg" alt="取得的数据"></p>
<p>然后我们可以计算得到 offset 差值分别为 70, 70 ,170, 20, 93, 160, 90, 70</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec83907757.jpg" alt="计算后"></p>
<p>在这里，我们可以看到，offset差值是70 且 id 为 1 的有3 个，offset差值是170 且 id 为 1的有一个，offset差值是20 且 id 为 2 的有1 个，offset差值是933 且 id 为 3 的有一个……</p>
<p>所以最多就是 有3个的那个值。也就是id为1的歌曲。</p>
<p>有人会问，为什么不一首歌一首歌的检索呢，因为慢。</p>
<p>接下来代码。<br>获取所有匹配的指纹，并将歌曲信息与offset差值保存下来。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec838d9044.jpg" alt="匹配"></p>
<p>对数据进行处理，得出相同offset差值最多的歌曲，也就是识别出来的歌曲。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5ec838f1c1a.jpg" alt="处理"></p>
<p>结束。</p>
<p>转载请先获得许可</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.aynakeya.com/articles/blogarchive/2019-02-09-17-01-47/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/static/intro/images/avatar.jpg">
      <meta itemprop="name" content="Aynakeya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aynakeya's Blog">
      <meta itemprop="description" content="my blog~">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="blog | Aynakeya's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/articles/blogarchive/2019-02-09-17-01-47/" class="post-title-link" itemprop="url">shazam听歌识曲算法解析+python实现-2 生成指纹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-02-09 17:01:47" itemprop="dateCreated datePublished" datetime="2019-02-09T17:01:47+08:00">2019-02-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>第二部份<br>在开始之前，我们首先要认真阅读一下论文《An Industrial-Strength Audio Search Algorithm》，最好是一个字一个字，一个图一个图的把paper看下来（然后你就不需要来看这篇文章了，笑）</p>
<p>paper下载链接：<a target="_blank" rel="noopener" href="https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf">https://www.ee.columbia.edu/~dpwe/papers/Wang03-shazam.pdf</a><br>中文翻译：<a target="_blank" rel="noopener" href="https://blog.csdn.net/yutianzuijin/article/details/49787551">https://blog.csdn.net/yutianzuijin/article/details/49787551</a><br>建议读英文的鸭。</p>
<p>好的，那么正式开始。</p>
<p>基本原理：对于每个音频，我们都要给他生成一些特殊的指纹，然后用这些指纹和要识别的歌曲进行比较，最后取匹配率最高的那个，就是识别出来的歌曲啦~</p>
<p>听起来是不是非常简单鸭~~~~</p>
<p>那么怎么生成这个指纹呢，好问题！我们要分为三个步骤：</p>
<p>1、生成频谱图（频域图像）。</p>
<p>2、在频谱图的基础上计算出Constellation Map（星状图）</p>
<p>3、对星状图进行处理，生成指纹哈希。</p>
<p>首先是生成频谱图。</p>
<p>为了生成频谱图，我们就得把歌曲最开始拿出来的数据进行一波傅里叶变换，把时域信号转变为频域信号。</p>
<p>什么？你不知道傅里叶变换（Fourier Transformation）？不如看看这个<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/19759362">https://zhuanlan.zhihu.com/p/19759362</a></p>
<p>但是，傅里叶变换有一个缺陷，那就是他在变换过程中把时间信息丢失了，也就是说傅里叶变换“不能反映时间维度局部区域上的特征, 人们虽然从傅立叶变换能清楚地看到一整段信号包含的每一个频率的分量值，但很难看出对应于频率域成分的不同时间信号的持续时间和发射的持续时间，缺少时间信息使得傅立叶分析再更精密的分析中失去作用[1]。“</p>
<p>在听歌识曲中，时间是一个非常重要的因素。如果我们没有了时间，我就不知道什么频率在什么时候出现，强度又是多少。</p>
<p>所以，我们不能抛弃时间这个变量。因此，我们可以利用短时傅里叶变换（STFT，short time Fourier transformation）来对音频数据进行分析和计算。<br>短时傅里叶变换通过加窗操作，把信号分成一段一段来计算，这样子在将时域型号转变为频域信号的同时，保留住时间了。</p>
<p>这看起来非常困难，但是！python中大量的第三方库给予了我们极大的便利。</p>
<p>这里我们用到了<code>matplotlib</code> 中的<code> mlab.specgram</code> 来对音频数据进行分析。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620b352.jpg" alt="生成频谱图"></p>
<p>如图所示，只要我们把上一步中取到的音频数据（sample 每一个channel中的数据），放到里面，然后加上一些参数就好啦。</p>
<p>对于这些参数，我们可以取默认值，也可以自己修改。有兴趣可以去官方文档里看。</p>
<p>我的取值是 nfft &#x3D; 4096, nooverlap &#x3D; 2048, window(加窗函数)用的是Hamming窗函数，fs是音频的采样速率。</p>
<p>接着，我们还可以对数据进行一些操作，比如：对取出来的值进行log运算，将其放到对数空间中，便于数据之间的比较与操作（因为不放入对数空间的话，数值可能会很大）。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620f54a.jpg" alt="放入对数空间中"></p>
<p>像这样，通过log10 之后的强度大小（或者说能量大小）范围便会控制在0-70这个范围之内啦。</p>
<p>频谱图的样子：</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97ac25331.jpg" alt="au中的"></p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620f04b.jpg" alt="论文中的"></p>
<p>好的，生成了频谱图，接下来我们要做的就是第二步，生成Constellation Map！</p>
<p>首先我们来看看星状图到底长什么样（如果你读过paper,或许可能已经知道了）</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620c085.jpg" alt="论文中下星状图"></p>
<p>根据paper中所说的，能量越大的点抗噪性就越强，所以我们将能量大的点作为判断依据。</p>
<p>在频谱图中，颜色越亮代表该点的能量越大。仔细观察一下，每个点（也就是星星）的位置是不是都在都在颜色比较亮的地方。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97ac1a4e0.png" alt="myplot生成的"></p>
<p> 小小的解释一下，这个频谱图看起来是二维的，实际上是三维的，包含时间，频率，以及能量大小（强度）</p>
<p>那么，我们要如何找到这些能量较大的点呢？（由于up能力有限，只能复制粘贴别人的方法了）。</p>
<p>我们可以scipy利用图像分析法来找到这些点。</p>
<p>好的，我们请看worldveil大神在项目dejavu [2]中带来的算法（鼓掌！！！！！！！！）。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e9762206fe.jpg" alt="获得极值"></p>
<p>minimun_peak_amplitude 是可以认为是能量较大点的最小能量值（在log空间中它 的取值范围是0-70），取得越高，产生的能量较大点的数量就越少，准确率就越低，但也不要取的太小。我在这里取了minimun_peak_amplitude&#x3D;10<br>peak_neighborhood_size 是一个点想要成为能量较大点，也就是local maximum 所处的领域的大小。越小的话产生的点会越多，不建议太大，也不建议太小。我在这里取了peak_neighborhood_size &#x3D; 20</p>
<p>其中frequency_idx 和time_idx 就是能量较大的点所处的频率坐标和时间坐标了。</p>
<p>我们可以用zip函数把他们组成坐标的形式[(t1,f1),(t2,f2),(t3,f3)……]</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e9761c092c.jpg" alt="zip函数"></p>
<p>其实到这里，我们已经可以通过这个星状图来对歌曲进行识别了，只要看某个片段是否能够与整首歌中某一块区域的对上就可以判断了。</p>
<p>论文的作者是这样子描述的：If you put the constellation map of a database song on a strip chart, and the constellation map of a short matching audio sample of a few seconds length on a transparent piece of plastic, then slide the latter over the former, at some point a significant number of points will coincide when the proper time offset is located and the two constellation maps are aligned in register. [4] 数据库中某首歌的星状图散乱在一个条形图上，然后将几秒样本的星状图放在一个透明的塑料板上。在条形图上滑行塑料板（有点像游标卡尺），到某个时刻的时候就会出现一件神奇的事情：当样本和数据库歌曲的正确位置对齐时，重叠的极大值就会格外多，这样就意味着样本和数据库中正确音乐的正确位置匹配上了！[3]</p>
<p>但是，这样子做需要耗费大量的时间，如何才能加快呢。我们可以对这些坐标进行快速组合哈希来获取最终的指纹。</p>
<p>所以第三步！对星状图进行处理，生成指纹哈希。</p>
<p>在生成指纹哈希的基本原理：将两个能量最高的点组合在一起，生成一个指纹，包含由两者的频率和时间差组成的哈希，以及锚点的时间位置。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620b9f9.jpg" alt="基本原理"></p>
<p>为此，我们首先要选择一个锚点（anchor point），然后每个锚点都对应一个目标区域（target zone）。（ps: 这个target zone 的选择极为讲究，我踩了一堆坑。）</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97620db47.jpg" alt="锚点和目标区域"></p>
<p>target zone与anchor point的距离不宜靠的太近，也不宜离得太远，</p>
<p>前者会导致选择的两个点没有独特性，从而使生成 的哈希没有什么卵用；</p>
<p>后者会导致两个点的时间跨度太大,也会使生成哈希没什么鸡儿用。所以，这个时候我们要认真看一下论文中的图。</p>
<p>上图可以发现，anchor point 和 target zone 之间至少隔了5个时间单位，小于5个时间单位的都没选。</p>
<p>所以，我们在选择target zone的时候，时间差最好要超过5个单位。如果你们不信的话可以自己试一试，up被这个坑了好久。</p>
<p>接下来上代码</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e9761e5f41.jpg" alt="捕获排序"></p>
<p>首先，我们要对上一步中取得的那些能量较大点以时间顺序进行排序。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97abef92f.jpg" alt="操作一波"></p>
<p>然后，我们将每一个能量较大点后的n个点作为target zone的范围。这个n称为fan-out。Fan-out用来决定每一个anchor point 最多可以与多少个点进行匹配。</p>
<p>同时，我们通过判断两个点之间的时间差是否在我们需要的范围内，来最终决定是否将这两个点作为歌曲的指纹放入数据库中。</p>
<p>time_constraint_condition 是一个 元组，包含可以作为指纹的两个点的最小时间差和最大时间差，up的取值是 (9,200)<br>fanout_factor 越大，生成的指纹就越多，在提高成功率的同时增大了所需要的储存空间以及牺牲了一点点的查询速度。up 的取值是 fanout_facotr &#x3D; 20 (论文中说大于10就可以了)</p>
<p>然后，我们只需要把两个点的频率以及时间差组合起来，生成一个哈希，在加上anchor point的时间位置，一个指纹就生成好了。</p>
<p><img data-src="https://i.loli.net/2019/02/09/5c5e97abe7bae.jpg" alt="生成指纹"></p>
<p>嘛，生成指纹的部分就完成啦。接下来就只有搜索与识别的部分了。</p>
<p>结束。</p>
<p>转载请先获得许可。</p>
<p>[1]: <a target="_blank" rel="noopener" href="https://blog.csdn.net/lvsehaiyang1993/article/details/80521538">https://blog.csdn.net/lvsehaiyang1993/article/details/80521538</a></p>
<p>[2]: <a target="_blank" rel="noopener" href="https://github.com/worldveil/dejavu">https://github.com/worldveil/dejavu</a></p>
<p>[3]: <a target="_blank" rel="noopener" href="https://blog.csdn.net/yutianzuijin/article/details/49787551">https://blog.csdn.net/yutianzuijin/article/details/49787551</a></p>
<p>[4]: Wang, Avery. &quot;An Industrial Strength Audio Search Algorithm.&quot; Ismir. Vol. 2003. 2003.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/blog/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/blog/page/10/">10</a><a class="page-number" href="/blog/page/11/">11</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/blog/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Aynakeya</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
